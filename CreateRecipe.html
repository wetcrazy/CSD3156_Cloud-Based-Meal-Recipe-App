<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Recipe</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <div class="navbar">
    <a class="navbar-title" href="index.html"><h1>Online Cookbook</h1></a>
    <div class="nav-links">
      <button onclick="location.href='index.html'">Home</button>
    </div>
  </div>

  <div class="create-recipe-form">
    <form>
      <label for="recipeName">Recipe Name:</label>
      <input type="text" name="recipeName" required>

      <label for="recipeDescription">Description:</label>
      <textarea name="recipeDescription" rows="3" required></textarea>

      <label for="recipeTimeTaken">Time Taken:</label>
      <input type="text" name="recipeTimeTaken" required>

      <label for="recipeSteps">Steps:</label>
      <textarea name="recipeSteps" rows="6" required></textarea>

      <label>Ingredients & Quantities:</label>
      <div class="ingredient-list" id="ingredient-list">
        <div class="ingredient-group">
          <select name="ingredient_ids[]" required>
            <option value="">-- Select Ingredient --</option>
            <option value="1">Flour</option>
            <option value="2">Sugar</option>
            <option value="3">Eggs</option>
            <option value="4">Milk</option>
          </select>
          <input type="text" name="quantities[]" placeholder="e.g. 2 cups" required>
          <button type="button" class="remove-btn" onclick="removeIngredient(this)">Remove</button>
        </div>
      </div>

      <button type="button" class="submit-btn" onclick="addIngredient()">+ Add Ingredient</button>
      <button type="button" class="submit-btn" onclick="showAddIngredientModal()">+ Add New Ingredient</button>

      <label for="recipeImage">Upload Image:</label>
      <input type="file" name="recipeImage" accept="image/*" required>

      <button type="submit">Create Recipe</button>
    </form>
  </div>

  <!-- Add Ingredient Modal -->
  <div class="popup-overlay" id="popupOverlay" onclick="hideAddIngredientModal()"></div>
  <div class="popup" id="addIngredientModal">
    <form onsubmit="addNewIngredient(event)">
      <h3>Add New Ingredient</h3>
      <input type="text" id="ingredientName" placeholder="Ingredient Name" required>
      <input type="text" id="ingredientUnit" placeholder="Unit (e.g. grams)" required>
      <button type="submit" class="submit-btn">Add Ingredient</button>
      <button type="button" class="remove-btn" onclick="hideAddIngredientModal()">Cancel</button>
    </form>
  </div>

  <script>
    const ingredientOptions = [
      { id: 1, name: "Flour" },
      { id: 2, name: "Sugar" },
      { id: 3, name: "Eggs" },
      { id: 4, name: "Milk" }
    ];

    function updateAllIngredientDropdowns() {
      const selects = document.querySelectorAll('select[name="ingredient_ids[]"]');
      selects.forEach(select => {
        select.innerHTML = '<option value="">-- Select Ingredient --</option>' +
          ingredientOptions.map(opt => `<option value="${opt.id}">${opt.name}</option>`).join('');
      });
    }

    function addIngredient() {
      const list = document.getElementById('ingredient-list');
      const newGroup = document.createElement('div');
      newGroup.className = 'ingredient-group';

      const dropdown = '<select name="ingredient_ids[]" required>' +
        '<option value="">-- Select Ingredient --</option>' +
        ingredientOptions.map(opt => `<option value="${opt.id}">${opt.name}</option>`).join('') +
        '</select>';

      newGroup.innerHTML = `
        ${dropdown}
        <input type="text" name="quantities[]" placeholder="e.g. 1 tbsp" required>
        <button type="button" class="remove-btn" onclick="removeIngredient(this)">Remove</button>
      `;
      list.appendChild(newGroup);
    }

    function removeIngredient(btn) {
      btn.parentElement.remove();
    }

    function showAddIngredientModal() {
      document.getElementById("addIngredientModal").style.display = "block";
      document.getElementById("popupOverlay").style.display = "block";
    }

    function hideAddIngredientModal() {
      document.getElementById("addIngredientModal").style.display = "none";
      document.getElementById("popupOverlay").style.display = "none";
    }

    function addNewIngredient(event) {
      event.preventDefault();
      const name = document.getElementById('ingredientName').value.trim();
      const unit = document.getElementById('ingredientUnit').value.trim();

      if (name && unit) {
        const newId = ingredientOptions.length + 1;
        ingredientOptions.push({ id: newId, name: `${name} (${unit})` });
        updateAllIngredientDropdowns();
        hideAddIngredientModal();

        document.getElementById('ingredientName').value = '';
        document.getElementById('ingredientUnit').value = '';
      }
    }
  </script>

</body>
</html>